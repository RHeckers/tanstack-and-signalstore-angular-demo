<section
  class="pokedex"
  aria-labelledby="pokedex-heading"
  data-testId="pokedex-overview"
>
  <header class="pokedex__intro" data-testId="pokedex-intro">
    <div>
      <h2 id="pokedex-heading">{{ routeTitle }}</h2>

      <section class="pokemon__controls-container">
        <div class="pokemon__type-controls">
          <label for="pokedex-type-filter-select">Explore by type:</label>
          <select
            id="pokedex-type-filter-select"
            [ngModel]="activeType()"
            (change)="onTypeFilterChange($event)"
            data-testId="pokedex-type-filter"
          >
            @for (type of types(); track type) {
              <option [value]="type">
                {{ type | titlecase }}
              </option>
            }
          </select>
        </div>
      </section>
    </div>
  </header>

  <section class="pokedex__collection-toggle">
    <label class="toggle" for="add-collection-toggle">
      <span class="toggle__label">Add to collection</span>
      <span class="toggle__track">
        <input
          type="checkbox"
          id="add-collection-toggle"
          class="toggle__input"
          [(ngModel)]="addToCollection"
          data-testId="add-collection-toggle"
        />
        <span class="toggle__slider" aria-hidden="true"></span>
      </span>
    </label>
  </section>

  <section class="pokemon__controls-container">
    <div class="pokemon__paging-controls">
      <button
        class="pokedex__page-button"
        data-testId="pokedex-prev-page"
        (click)="onPrevPage()"
        [disabled]="activePage() === 1"
      >
        Previous
      </button>
      <span data-testId="pokedex-current-page">
        Page {{ activePage() }} of {{ totalPages() }}
      </span>
      <button
        class="pokedex__page-button"
        data-testId="pokedex-next-page"
        (click)="onNextPage()"
        [disabled]="activePage() === totalPages()"
      >
        Next
      </button>
    </div>

    <div class="pokemon__page-count-controls">
      <label for="pokedex-goto-page-input">Pokemon per page:</label>
      <app-number-input
        [value]="30"
        (valueChange)="onPokemonPerPageChange($event)"
      />
    </div>
  </section>

  @if (loading() && !pokemons().length) {
    <p class="pokedex__status" data-testId="pokedex-loading">
      Loading Pokémon…
    </p>
  } @else if (error()) {
    <p
      class="pokedex__status pokedex__status--error"
      role="alert"
      data-testId="pokedex-error"
    >
      {{ error() }}
    </p>
  } @else {
    <section
      class="pokedex__grid"
      aria-live="polite"
      data-testId="pokedex-grid"
    >
      @for (pokemon of pokemons(); track pokemon.id) {
        <article class="pokedex-card" data-testId="pokemon-card">
          @if (addToCollection() && !pokemon.inCollection) {
            <button
              type="button"
              class="pokedex-card__add-button"
              aria-label="Add {{ pokemon.name | titlecase }} to collection"
              data-testId="pokemon-add-button"
              (click)="onAddToCollection(pokemon)"
            >
              +
            </button>
          }
          <a
            [routerLink]="['/pokemon', pokemon.name]"
            class="pokedex-card__link"
            data-testId="pokemon-link"
          >
            <figure class="pokedex-card__media">
              <img
                [src]="pokemon.image"
                [alt]="pokemon.name | titlecase"
                aria-label="Pokemon image"
                width="160"
                height="160"
                loading="lazy"
                data-testId="pokemon-image"
              />
            </figure>
            <div class="pokedex-card__body">
              <h3 data-testId="pokemon-name">
                {{ pokemon.name | titlecase }}
              </h3>
              @if (pokemon.types.length > 0) {
                <ul class="pokedex-card__types" data-testId="pokemon-types">
                  @for (type of pokemon.types; track type) {
                    <li data-testId="pokemon-type">{{ type | titlecase }}</li>
                  }
                </ul>
              }
            </div>
          </a>
        </article>
      }
    </section>
  }
</section>
